{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "http://docs.derivacloud.org/schemas/visible_foreign_keys.schema.json",
    "title": "tag:isrd.isi.edu,2016:visible-foreign-keys",
    "description": "Schema document for the 'visible-foreign-keys' annotation.",
    "definitions": {

        "constraint-name": { "$ref": "http://docs.derivacloud.org/schemas/source_definitions.schema.json#/definitions/constraint-name" },
        "source-entry": { "$ref": "http://docs.derivacloud.org/schemas/source_definitions.schema.json#/definitions/source-entry" },
        "source-key": { "$ref": "http://docs.derivacloud.org/schemas/source_definitions.schema.json#/definitions/source-key" },
        "display": { "$ref": "http://docs.derivacloud.org/schemas/source_definitions.schema.json#/definitions/display" },

        "visible-fkeys-entry": {
            "oneOf": [
                 { "$ref": "#/definitions/context-name" },
                 { "$ref": "#/definitions/fkey-list" }
            ]
        },

        "context-name": { "type": "string" },

        "fkey-list": {
            "type": "array",
            "items": {
                "anyOf": [
                    { "$ref": "#/definitions/inbound-foreign-key" },
                    { "$ref": "#/definitions/pseudo-column" }
                ]
            }
        },

        "inbound-foreign-key": {
            "$comment": "A constraint name that is a valid inbound foreign key reference to this annotated table",
            "allOf": [
                {
                    "$ref": "#/definitions/constraint-name"
                },
                {
                    "valid-constraint": ["inbound"]
                }
            ]
        },

        "pseudo-column": {

            "type": "object",

            "properties": {

                "source": { "$ref": "#/definitions/source-entry" },
                "sourcekey": { "$ref": "#/definitions/source-key" },

                "entity": { "type":  "boolean", "const": true },
                "markdown_name": { "type": "string" },
                "display": { "$ref": "#/definitions/display" }
            },

            "additionalProperties": false,

            "anyOf": [
                {
                    "required": [ "source" ],
                    "not": { "required": [ "sourcekey" ] }
                },
                {
                    "required": [ "sourcekey" ],
                    "allOf": [
                        { "not": { "required": [ "source" ] } },
                        { "not": { "required": [ "entity" ] } }
                    ]
                }
            ]
        }
    },

    "type": "object",
    "properties": {
        "*": { "$ref": "#/definitions/visible-fkeys-entry" },
        "detailed": { "$ref": "#/definitions/visible-fkeys-entry" }
    },
    "additionalProperties": false
}
